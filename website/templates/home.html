{% extends "base.html" %} {% block title %}Home{% endblock %} {% block content
%}

<!-- Header Section -->
<header class="text-center my-5">
  <h1 class="display-3">StudyPal</h1>
  <small>
    <h2>The easiest way to better grades!</h2>
  </small>
  <!-- Combined Search Form -->
  <form action="/search" method="get" class="input-group my-3">
    <!-- University Dropdown -->
    <select class="custom-select" id="university" name="university" onchange="updateSubjects(); updateCourses();">
      <option selected>Choose a university...</option>
      {% for university in universities %}
      <option value="{{ university }}">{{ university }}</option>
      {% endfor %}
    </select>

    <!-- Subject Dropdown -->
    <select class="custom-select" id="subject" name="subject" onchange="updateUniversities(); updateCourses();">
      <option selected>Choose a subject...</option>
      {% for subject in subjects %}
      <option value="{{ subject }}">{{ subject }}</option>
      {% endfor %}
    </select>

    <!-- Courses Dropdown, initially disabled -->
    <select class="custom-select" id="course" name="course" disabled>
      <option selected>Choose a course...</option>
      <!-- Course options will be populated based on the selected university and subject -->
    </select>

    <!-- Search Input -->
    <input
      type="text"
      class="form-control"
      placeholder="Search for documents, courses, exams..."
      name="query"
    />
    <div class="input-group-append">
      <button class="btn btn-outline-secondary" type="submit">Search</button>
    </div>
  </form>
</header>

<script>
  // Capture the initial subjects dropdown HTML
  var initialUniversitiesHTML = document.getElementById('university').innerHTML;
  var initialSubjectsHTML = document.getElementById('subject').innerHTML;
  let universitySelected = 0;
  let subjectSelected = 0;

function updateCourses() {
    var universitySelect = document.getElementById('university');
    var subjectSelect = document.getElementById('subject');
    var courseSelect = document.getElementById('course');
    var selectedUniversity = universitySelect.value;
    var selectedSubject = subjectSelect.value;

    if ((selectedUniversity !== 'Choose a university...' && selectedUniversity) &&
        (selectedSubject !== 'Choose a subject...' && selectedSubject)) {
        fetch(`/get-courses?university=${selectedUniversity}&subject=${selectedSubject}`)
            .then(response => response.json())
            .then(courses => {
                courseSelect.innerHTML = '<option selected>Choose a course...</option>';
                courses.forEach(course => {
                    var option = document.createElement('option');
                    option.value = course;
                    option.textContent = course;
                    courseSelect.appendChild(option);
                });
                courseSelect.disabled = false;
            });
    } else {
        courseSelect.innerHTML = '<option selected>Choose a course...</option>';
        courseSelect.disabled = true; // Disable the course dropdown if either selection is the default
    }
}    


function updateSubjects() {
    var universitySelect = document.getElementById('university');
    var subjectSelect = document.getElementById('subject');
    var selectedUniversity = universitySelect.value;

    // Check if a university has been selected
    if ((selectedUniversity && selectedUniversity !== 'Choose a university...') &&
       (subjectSelected === 0)) {
        universitySelected = 1;
        fetch(`/get-subjects?university=${selectedUniversity}`)
            .then(response => response.json())
            .then(subjects => {
            subjectSelect.innerHTML = '<option selected>Choose a subject...</option>';       
                subjects.forEach(subject => {
                    var option = document.createElement('option');
                    option.value = subject;
                    option.textContent = subject;
                    subjectSelect.appendChild(option);
                });

                // Reset and disable the course dropdown until a subject is selected
                courseSelect.innerHTML = '<option selected>Choose a course...</option>';
                courseSelect.disabled = true;
            });
    } else if (selectedUniversity && selectedUniversity !== 'Choose a university...') {
        //Nothing needs to be done
    } else {
        universitySelected = 0;
        // Reset the dropdown to its initial state when no university is selected
        subjectSelect.innerHTML = initialSubjectsHTML;
    }
}

function updateUniversities() {
    var universitySelect = document.getElementById('university');
    var subjectSelect = document.getElementById('subject');
    var selectedSubject = subjectSelect.value;
    if ((selectedSubject && selectedSubject !== 'Choose a subject...') &&
       (universitySelected === 0)) {
        subjectSelected = 1;
        fetch(`/get-universities?subject=${selectedSubject}`)
            .then(response => response.json())
            .then(universities => {
            universitySelect.innerHTML = '<option selected>Choose a university...</option>';
                universities.forEach(university => {
                    var option = document.createElement('option');
                    option.value = university;
                    option.textContent = university;
                    universitySelect.appendChild(option);
                });

                // Reset and disable the course dropdown until a subject is selected
                courseSelect.innerHTML = '<option selected>Choose a course...</option>';
                courseSelect.disabled = true;
            });
    } else if (selectedSubject && selectedSubject !== 'Choose a subject...') {
        //Nothing needs to be done
    } else {
        subjectSelected = 0;
        // Reset the dropdown to its initial state when no subject is selected
        universitySelect.innerHTML = initialUniversitiesHTML;
    }
}

</script>

<section class="text-center my-5">
  <div class="container">
    <div class="row">
      <!-- Stats Item -->
      <div class="col">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">50+</h5>
            <p class="card-text">University</p>
            <p class="card-text">
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Suscipit
              delectus dignissimos.
            </p>
          </div>
        </div>
      </div>
      <!-- Stats Item -->
      <div class="col">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">450K+</h5>
            <p class="card-text">Students</p>
            <p class="card-text">
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Suscipit
              delectus dignissimos.
            </p>
          </div>
        </div>
      </div>
      <!-- Add more stats items as necessary -->
    </div>
  </div>
</section>

<!-- About Section -->
<section class="my-5">
  <div class="container">
    <h2 class="text-center">ABOUT STUDYPAL</h2>
    <p>
      Lorem, ipsum dolor sit amet consectetur adipisicing elit. Commodi neque
      illum dolore quidem architecto ratione quod perferendis minima cupiditate
      facere a suscipit numquam eligendi molestiae eos esse dolores,
      voluptatibus officiis!
    </p>
    <!-- Add more content about STUDYPAL here -->
  </div>
</section>

{% endblock %}
